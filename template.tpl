___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___
 
{
  "displayName": "Eficads",
  "description": "Eficads Sales and Leads Tracking Tag.",
  "categories": [
    "AFFILIATE_MARKETING",
    "MARKETING",
    "ATTRIBUTION"
  ],
  "securityGroups": [],
  "id": "cvt_temp_public_id",
  "type": "TAG",
  "version": 1,
  "brand": {
    "thumbnail": "data:image/png;base64,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\u003d",
    "displayName": "Eficads",
    "id": "github.com_tradetracker-com"
  },
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "help": "Please select whether this tag should track sale events (retail orders and transactions), or if it should track lead events. Leads can be any custom visitor actions such as newsletter signups or demo requests.",
    "type": "TEXT",
    "name": "hostname",
    "displayName": "Dominio",
    "simpleValueType": true
  },
  {
    "help": "Please select whether this tag should track sale events (retail orders and transactions), or if it should track lead events. Leads can be any custom visitor actions such as newsletter signups or demo requests.",
    "macrosInSelect": false,
    "selectItems": [
      {
        "displayValue": "Sales Tag",
        "value": "sale"
      },
      {
        "displayValue": "Leads Tag",
        "value": "lead"
      }
    ],
    "displayName": "Tag Type",
    "simpleValueType": true,
    "name": "tagType",
    "type": "SELECT"
  },
  {
    "help": "Please enter your TradeTracker.com Campaign ID, or a variable that will return this value. If you run multiple campaigns please ensure it is the correct Id.\u003c/br\u003e\u003c/br\u003eIf you\u0027re unsure of what number to use, please  check in your Advertiser Dashboard or contact your Account Manager for assistance.",
    "displayName": "Account ID",
    "simpleValueType": true,
    "name": "accountID",
    "type": "TEXT"
  },
  {
    "displayName": "Event ID",
    "simpleValueType": true,
    "name": "eventID",
    "type": "TEXT"
  },
  {
    "help": "Please select the dataLayer variable for your Transaction or Order Id.\u003c/br\u003e\u003c/br\u003eFor the Sales tag this should be the same Id that you use to track sales internally, and it should be unique for every transaction.\u003c/br\u003e\u003c/br\u003eFor the Leads tag the Transaction Id can be any number you choose but also must be unique for each event.",
    "displayName": "Transaction ID",
    "simpleValueType": true,
    "name": "orderID",
    "type": "TEXT"
  },
  {
    "help": "Please select the dataLayer variable for the Total Transaction (Order) Amount \u003cstrong\u003eexcluding any applicable tax\u003c/strong\u003e.\u003c/br\u003e\u003c/br\u003eThis should be formatted as a string currency amount, for example $1,234.56 should be formatted as \"1234.56\".",
    "enablingConditions": [
      {
        "paramName": "tagType",
        "type": "EQUALS",
        "paramValue": "sale"
      }
    ],
    "displayName": "Transaction Amount",
    "simpleValueType": true,
    "name": "orderValue",
    "type": "TEXT"
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

// Permissions
const encodeUriComponent = require('encodeUriComponent');
const query              = require('queryPermission');
const sendPixel          = require('sendPixel');

// Set values from tag config
const accountID  = data.hasOwnProperty('accountID') ? '' + data.accountID : '';
const eventID   = data.hasOwnProperty('eventID') ? '' + data.eventID : '';
const orderID     = data.hasOwnProperty('orderID') ? '' + data.orderID : '';
const orderValue = data.hasOwnProperty('orderValue') ? '' + data.orderValue : '';
const hostname = data.hasOwnProperty('hostname') ? '' + data.hostname : '';

// Set tracking host
let domain = '';
if (data.hasOwnProperty('hostname') && data.hostname !== undefined) {
  domain = data.hostname;
} else {
  domain = data.tagType === 'sale' ? 'tbs.tradedoubler.com' : 'tbs.tradedoubler.com';
}

// Construct Pixel URL
let imgUrl = 'https://' + domain + '/report?organization=' + encodeUriComponent(accountID) + '&event=' + encodeUriComponent(eventID);
if (data.tagType === 'sale') {
  imgUrl += '&orderNumber=' + encodeUriComponent(orderID);
  imgUrl += '&orderValue=' + encodeUriComponent(orderValue);
} else {
  imgUrl += '&orderNumber=' + encodeUriComponent(orderID);
}

// Call data.gtmOnSuccess when the tag is finished.
if (query('send_pixel', imgUrl)) {
  sendPixel(imgUrl, data.gtmOnSuccess, data.gtmOnFailure);
}


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "send_pixel",
        "versionId": "1"
      },
      "param": [
        {
          "key": "allowedUrls",
          "value": {
            "type": 1,
            "string": "any"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios:
- name: Test
  code: |-
    const mockData = {
      // Mocked field values
    };

    // Call runCode to run the template's code.
    runCode(mockData);

    // Verify that the tag finished successfully.
    assertApi('gtmOnSuccess').wasCalled();


___NOTES___

Created on 29/08/2019, 16:10:24


